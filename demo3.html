<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="format-detection" content="email=no" />
    <title>牵台车</title>
    <script type="text/javascript" src="/qtc/js/public.js"></script>
    <link rel="stylesheet" href="/qtc/css/sm.min.css">
    <link rel="stylesheet" href="/qtc/css/page3.css">
    <link rel="stylesheet" href="/qtc/css/layer.css">
    <style type="text/css">
        .picker-columns {
            height: 5.2rem;
            width: 100%;
        }

        .picker-items {
            font-size: 0.36rem;
            background: #fff;
            -webkit-mask-box-image: none;
        }

        .topPart {
            height: 1.5rem;
            width: 100%;
            background: #fff;
            position: relative;
            color: #000;
            border-bottom: 1px solid #ededed;
        }

        .top-title {
            height: 1.5rem;
            line-height: 1.5rem;
            width: 100%;
            text-align: center;
            font-size: 0.36rem;
        }

        .close-picker {
            display: block;
            height: 0.6rem;
            width: 1.4rem;
            line-height: 0.6rem;
            text-align: center;
            font-size: 0.36rem;
            color: #fff;
            border-radius: 5px;
        }

        .sureBtn {
            position: absolute;
            right: 0.4rem;
            top: 0.45rem;
            background: #ff795c;
        }

        .cancelBtn {
            position: absolute;
            left: 0.4rem;
            top: 0.45rem;
            background: #999;
        }

        .picker-center-highlight {
            margin-top: -58px;
        }
        .picker-items-col-wrapper {
            margin-top: -40px;
        }
    </style>
</head>
<body>
<div class="con-title con-title-black">
    <p class="emptyBox emptyBox-black"></p>
    <p class="backBtn" ><i></i>返回</p>
    <p class="txt">申请资料填写</p>
</div>
    <div id="con">
        @if($product_id==12 || $product_id==14 || $product_id==15)
            <div class="chooseCards">
                <p class="txt1 underLine">请选择产品方案</p>
                <div class="cards">
                    <p class="chooseCard card1 underLine">
                        <span class="txt">产品方案1（1+3）</span>
                        <i class="@if($product_scheme==1) checked @else unchecked @endif"></i>
                    </p>
                    <p class="chooseCard card2 underLine">
                        <span class="txt">产品方案2（3年期）</span>
                        <i class="@if($product_scheme==2) checked @else unchecked @endif"></i>
                    </p>
                </div>
            </div>
        @endif
        <div class="appInfo">
            <p class="txt2 underLine">联系方式</p>
            <p class="infoIn underLine">
                <span><b>*</b> 姓名</span>
                <input id="name" type="text" class="infoCon" placeholder="请输入姓名">
            </p>
            <p class="infoIn underLine">
                <span><b>*</b> 性别</span>
                <!--<select  name="sex" id="sex">-->
                    <!--<option value="0" selected>点击选择性别 ></option>-->
                    <!--<option value="1">男</option>-->
                    <!--<option value="2">女</option>-->
                <!--</select>-->
                <input id="sex-picker" type="text"   placeholder="请选择性别">
                <i class="inputBg"></i>
            </p>
            <p class="infoIn underLine">
                <span><b>*</b> 电话</span>
                <input id="tel" type="number" placeholder="请输入联系方式">
            </p>
            <p class="infoIn underLine">
                <span><b>*</b> 城市</span>
                <input id='city-picker' value="" type="text"  readonly="" name="input_area" placeholder="点击选择所在城市"/>
                <i class="inputBg"></i>
            </p>
        <p class="infoIn underLine">
            <span>推荐人工号（非必填）</span>
            <input id="referrer_no" type="text" placeholder="请输入推荐人工号">
        </p>
            <p class="txtInput">
                <textarea name="remark" id="remarks" cols="30" rows="10" placeholder="点击输入您的留言"></textarea>
            </p>
            <input type="hidden" id="product_id" value="{{$product_id}}" />
        <input type="hidden" id="product_scheme"
               value="@if($product_id==6 || $product_id==7) 2 @else {{$product_scheme}} @endif"/>
        </div>
        <button class="submitBtn" type="button">立即申请</button>
    </div>
    <script src="/qtc/js/zepto/zepto.js"></script>
    <script src="/qtc/js/zepto/touch.js"></script>
    <script src="/qtc/js/zepto/fx.js"></script>
    <script src="/qtc/js/sm.min.js"></script>
    <script src="/qtc/js/sm-city-picker.js"></script>
    <script src="/qtc/js/layer.js"></script>

    <script type="text/javascript">

            $(function(){

                // 判断是否是微信
                if(isWeiXin()){
                    $(".con-title").removeClass("con-title-black");
                    $("#con").css({"padding-top":"0"});
                    $(".emptyBox").css({"display":"none"});
                    $(".backBtn").css({"top":"0.24rem"});
                    $(".backBtn i").addClass("icon2");
                } else {
                    // 判断是否是安卓
                    var isAndroid = navigator.userAgent.indexOf('Android') > -1 || navigator.userAgent.indexOf('Adr') > -1;
                    if(isAndroid){
                        $(".emptyBox").css({"display":"none"});
                        $(".backBtn").css({"top":"0.24rem"});
                        $("#con").css({"padding-top":"0.88rem"});
                    }
                }

                $(".chooseCards .chooseCard").on("click",function(){
                    $(this).find("i").removeClass("unchecked").addClass("checked");
                    $(this).siblings().find("i").removeClass("checked").addClass("unchecked");
                    $("#product_scheme").val($(this).index()+1);
                });
                //返回
                $(".backBtn").on("click",function(){
                    window.location.href = '/qtc/details?product_id={{$product_id}}&app_user={{$app_user}}'
                });
            });

            // 手机号码验证
            var reg1 = /^1[3|4|5|7|8]\d{9}$/;
            $("#tel").on("blur",function(){
                var $telNum = $("#tel").val();
                if(!reg1.test($telNum)){ // 手机号码格式错误
                    layer.open({
                        content: '请正确填写预约信息'
                        ,skin: 'msg'
                        ,time: 2 //2秒后自动关闭
                    });
                }
            });

            // 选择性别
            $("#sex-picker").picker({
                toolbarTemplate: '<header class="topPart">\
                <button class=" sureBtn  close-picker">确定</button>\
                <div class="top-title">选择性别</div>\
                </header>',
                cols: [
                    {
                        textAlign: 'center',
                        values: ['男','女']
                    }
                ]
            });

            // 城市选择器
            $("#city-picker").cityPicker({
                toolbarTemplate: '<header class="topPart">\
                <button class=" sureBtn  close-picker">确定</button>\
                <div class="top-title">选择所在城市</div>\
                </header>'
            });


            $(".infoCon").on("blur",function(){
                if($(this).val().replace(/\s*/g , "").length == 0){
                    layer.open({
                        content: '请正确填写预约信息'
                        ,skin: 'msg'
                        ,time: 2 //2秒后自动关闭
                    });
                }
            });


            $(".submitBtn").on("click",function(){
                var name = $("#name").val();
                var tel = $("#tel").val();
                var sex = $("#sex-picker").val();
                var city = $("#city-picker").val();
                var product_id = $("#product_id").val();
                var product_scheme = $("#product_scheme").val();
                var remarks = $("#remarks").val();
            var referrer_no = $("#referrer_no").val();

                if(!reg1.test(tel)){ // 手机号码格式错误
                    layer.open({
                        content: '请正确填写预约信息'
                        ,skin: 'msg'
                        ,time: 2 //2秒后自动关闭
                    });
                    return false;
                }

                if(name && tel && sex && city){
                    $("this").attr("disabled","disabled"); // 禁止多次提交
                    var app_user = "{{$app_user}}";
                    // 提交后台
                    $.ajax({
                        url: '/qtc/apply',
                        type: "post",
                data: {
                    'name': name,
                    'sex': sex,
                    'phone': tel,
                    'city': city,
                    'product_id': product_id,//产品id 
                    'product_scheme': product_scheme,// 方案
                    'remarks': remarks, //留言
                    'app_user': app_user,
                    'referrer_no': referrer_no //人工号
                },
                        dataType: "json",
                        success: function (json) {
                            if (json.code == '100') {
                                window.location.href = '/qtc/suc?id='+json.id;
                            } else {
                                alert(json.message);
                            }
                        }
                    });


                } else{
                    layer.open({
                        content: '请正确填写预约信息!'
                        ,skin: 'msg'
                        ,time: 2 //2秒后自动关闭
                    });
                }
            });
             //返回
        $('.navBarContent i').on('click', function () {
            history.back();
        });
    </script>
</body>
</html>