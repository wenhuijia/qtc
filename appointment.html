<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="format-detection" content="telephone=no">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="format-detection" content="email=no"/>
  <title>预约详情</title>
  <script type="text/javascript" src="js/public.js"></script>
  <!-- <script type="text/javascript" src="js/url.js"></script> -->
  <link rel="stylesheet" href="css/swiper.min.css">
  <link rel="stylesheet" href="css/appointment.css">
</head>

<body>
    <!-- 返回 -->
    <div class="TopGoBackNav">
        <div class="navBarTop"></div>
        <div class="navBarContent">
            <i></i>
            <p class="titleName">预约详情</p>
        </div>
    </div>
<!-- <div class="navBar">
  <p class="navBackBtn backBtn">
    <i></i>
    <span>返回</span>
  </p>
  <p class="titleName">预约详情</p>
</div> -->
<div id="con" class="topDistance">
  <!--预约时间-->
  <div class="appointmentInfo">
    <div id="carImage" class="carImg">
      <img src=""/>
    </div>
    <div class="carInfo">
      <p class="carName">福克斯 2017款 1.6L自动舒适型（两厢）</p>
      <P class="carTime">提交日期：<span>2017-09-23</span></P>
    </div>
  </div>
  <!--门店地址-->
  <div class="address">
    <div class="shopAddress">
      <p class="title">
        <span class="left"></span>
        <span class="middle">门店地址</span>
        <span class="right"></span>
      </p>
    </div>
    <div class="addressBox">
      <p class="company">广州海城店</p>
      <p class="addressDetail">广州市黄浦区黄埔东路1773号</p>
      <span class="icon"><img src="images/address.png"></span>
    </div>
  </div>
  <!--方案-->
  <div class="plans">
    <div class="planType">
      <p class="title">
        <span class="left"></span>
        <span class="middle">产品方案1 (1+3)</span>
        <span class="right"></span>
      </p>
    </div>
    <div class="boxWrap">
      <!--方案一-->
      <div id='program1' class="box box1">
        <div class="planImg planImg1">
          <img src="images/plan1.png" alt="">
          <p class="txt txt1">首期支付</p>
          <p class="txt txt2">一年租金</p>
          <p class="txt txt3">尾款支付<br>或再分期三年</p>
          <p class="txt txt4">车辆<br>价值</p>
        </div>
        <div class="priceDetail">
          <p class="p-title">
            <span class="left"></span>
            <span class="middle">先用一年</span>
            <span class="right"></span>
          </p>
          <div class="detail detail1">
            <p class="txt1">首付10%</p>
            <p name="ndownPayment" class="txt2 moneyNum">¥0</p>
            <p class="txt3">月供</p>
            <p name="nmonthlyPayment" class="txt4 moneyNum">¥0</p>
            <p class="txt5">含购置税/含保险等费用</p>
          </div>
          <p class="p-title p-title2">
            <span class="left"></span>
            <span class="middle">尾款购车</span>
            <span class="right"></span>
          </p>
          <div class="detail detail2">
            <p class="txt1">分期付款</p>
            <p class="txt2"><span name='mmonthlyPayment' class="moneyNum">¥0</span></p>
            <!--<p class="txt3">一次性付清:<span class="moneyNum">¥85000</span></p>-->
            <p class="txt3">一次性付清：<span>请咨询业务人员</span></p>
            <p class="txt4">尾款可选方案：一、1年后还车（限公里数）</p>
            <p class="txt5">二、1年后付尾款购车 </p>
            <p class="txt5">三、1年后尾款再分期三年</p>
          </div>
        </div>
      </div>
      <!--方案二(3年期)-->
      <div id='program2' class="box box2 boxHide">
        <div class="planImg planImg2">
          <img src="images/plan2.png" alt="">
          <p class="txt txt1">三年月租金</p>
          <p class="txt txt2">首付租金</p>
          <p class="txt txt3">车辆价值</p>
        </div>
        <table id="priceTab" cellpadding="0" cellspacing="0">
          <tr class="firstTr">
            <th>首付</th>
            <th>首期支付</th>
            <th>月租金</th>
          </tr>
        </table>
        <div class="txt11 ">
          <p class="left">
            <span>说明:</span>
          </p>
          <p class="right">
            <span>1、3年租赁期,到期过户;</span>
            <span>2、含购置税，保险等费用。</span>
          </p>
        </div>
      </div>
    </div>
  </div>
  <!--猜你喜欢-->
  <div class="like">
    <p class="title">
      <span><img src="images/like.png" alt=""></span>
      <span class="guessLike">猜你喜欢</span>
    </p>
  </div>
  <!--猜你喜欢的车-->
  <div class="likeCar">
    <div class="likeInfo box1">
      <div class="carImg">
        <img src="" />
      </div>
      <div class="carPrice">
        <h3>福克斯 2017款 1.6L自动舒适型（两厢）</h3>
        <p>首期支付 <span class="redColor">&yen;</span><span class="red">0</span></p>
        <p>首年月租 <span class="blueColor">&yen;</span><span class="blue">0</span></p>
        <p class="safe">含购置税保险等</p>
      </div>
    </div>
    <div class="likeInfo box2">
      <div class="carImg">
        <img src="" />
      </div>
      <div class="carPrice">
        <h3>福克斯 2017款 1.6L自动舒适型（两厢）</h3>
        <p>首期支付 <span class="redColor">&yen;</span><span class="red">0</span></p>
        <p>首年月租 <span class="blueColor">&yen;</span><span class="blue">0</span></p>
        <p class="safe">含购置税保险等</p>
      </div>
    </div>
  </div>

</div>
<script src="js/jquery-1.7.2.min.js"></script>
<script src="js/swiper.min.js"></script>
<script type="text/javascript">
  if(!isWeiXin()){
    $('#con').addClass("topDistance");
  };
  function toPercent(point) {
    var str = Number(point * 100).toFixed(0);
    str += "%";
    return str;
  }

  var userReservation; //创建安卓返回数据的全局变量
  var mUserLocation; //创建安卓返回户当前位置全局变量
  /*Android传参数返回数据到我的预约,将数据渲染页面，同时Android要调用此方法sendReservationDateToJs*/
  function sendReservationDateToJs(userReservationDate, currentLocation) {
    mUserLocation = currentLocation;//用户当前定位或者在热门城市选择的位置
    userReservation = userReservationDate;
    var productName = userReservationDate.productName;
    var finishedDate = userReservationDate.finishedDate;
    var storeName = userReservationDate.storeName;
    var storeAddress = userReservationDate.storeAddress;
    $('.appointmentInfo .carInfo .carName').html(productName);
    $('.appointmentInfo .carTime span').html(finishedDate);
    $('.addressBox .company').html(storeName);
    $('.addressBox .addressDetail').html(storeAddress);
    if (userReservationDate.planType == 2) {
      $('.planType .middle').html("产品方案2 (3年期)");
      $('.boxWrap .box1').hide();
      $('.boxWrap .box2').show();
    } else {
      $('.planType .middle').html("产品方案1 (1+3)");
      $('.boxWrap .box1').show();
      $('.boxWrap .box2').hide();
    }

    $("#carImage img").attr("src", jumpUrl + userReservationDate.image);
    //$("#carImage img").html("<img src='"+ jumpUrl + userReservationDate.image+"' />");

    $.ajax({
      type: "GET",
      headers: {"Content-Type": "application/json;charset=UTF-8"},
      url: baseUrl + "product/selectProgram?productId=" + userReservationDate.productId,
      success: function (data) {

        //获取有效方案数据
        var result = JSON.parse(data).result;
        if ($.isEmptyObject(result) || result == '[]') return;
        if (!$.isArray(result)) return;
        var len = result.length;
        var program = [];
        for (var i = 0; i < len; i++) {
          if (result[i].planType == userReservationDate.planType) {
            program.push(result[i]);
          }
        }

        //显示数据
        if (userReservationDate.planType == 1) {

          $('#program1 [name="ndownPayment"]').text("¥" + program[0].ndownPayment);
          $('#program1 [name="nmonthlyPayment"]').text("¥" + program[0].nmonthlyPayment);
          $('#program1 [name="mmonthlyPayment"]').text("¥" + program[0].mmonthlyPayment + "X" + program[0].mMonth + "月");

        } else if (userReservationDate.planType == 2) {

          var ht = "";
          for (var i = 0; i < program.length; i++) {
            ht += "<tr><td class='list1'>" + toPercent(program[i].monthlyRatio) + "</td>" +
              "<td class='list2 moneyNum'>¥" + program[i].mdownPayment + "</td>" +
              "<td class='list3 moneyNum'>¥" + program[i].mmonthlyPayment + "</td></tr>";
          }
          $('#priceTab').append(ht);
        } else {
        }
      }
    });
  }

  /*点击门店地址调百度导航,将名称、地址、经纬度传给android*/
  $('.address .addressBox').click(function () {
    var addressJson = {
      "sname": userReservation.storeName,
      "address": userReservation.storeAddress,
      "longitude": userReservation.storeLongitude,
      "latitude": userReservation.storeLatitude
    };
    window.NativeMethod.callBaiduNva(JSON.stringify(addressJson)); //调百度导航
  })

  /**调用后台猜你喜欢列表查询接口**/
  function lovely() {
    var lovelyOne;
    var lovelyTwo;
    var account = '';
    $.ajax({
      type: "GET",
      headers: {"Content-Type": "application/json;charset=UTF-8"},
      url: baseUrl + "product/selectUserLovelyList?account=" + account,
      success: function (data) {
        var results = JSON.parse(data).result;
        console.log(results);
        lovelyOne = results[0];
        lovelyTwo = results[1];
        /**方案类型为2,将值赋值给box1**/
        var name1 = lovelyOne.name;
        var ndownPayment1 = lovelyOne.ndownPayment;
        var nmonthlyPayment1 = lovelyOne.nmonthlyPayment;
        var description1 = lovelyOne.description;
        var imge1 = lovelyOne.image;
        $('.likeCar .box1 h3').html(name1);
        $('.likeCar .box1 .red').html(ndownPayment1);
        $('.likeCar .box1 .blue').html(nmonthlyPayment1);
        $('.likeCar .box1 .safe').html(description1);
        $('.likeCar .box1 .carImg img').attr('src', jumpUrl + imge1);
        //$('.likeCar .box1 .carImg img').html("<img src='"+ jumpUrl + imge1+"' />" );
        /*单击猜你喜欢一重新请求数据刷新，同时设置选中背景颜色和返回到顶部*/
        $('#con .likeCar .box1').click(function () {
          console.log("lovelyOne==" + JSON.stringify(lovelyOne));
          carModelIdVal = lovelyOne.carModelId;
          productIdVal = lovelyOne.productId;
          onTouch();
          /**
           * selectStute在产品详情页面定义,为”返回"按钮带参数1至跳转的页面，
           * 如果是1就返回h5页面，否则返回android页面,另外将城市、经度、
           * 纬度带至产品详情页定位地址
           */
          location.href = jumpUrl + "page2.html?carModelIdVal=" + carModelIdVal +
            "&productIdVal=" + productIdVal +
            "&selectStute=" + 1 +
            "&curCityname=" + mUserLocation.city +
            "&longitude=" + mUserLocation.longitude +
            "&latitude=" + mUserLocation.latitude;

        });

        /**方案类型为1,将值赋值给box2**/
        var name2 = lovelyTwo.name;
        var ndownPayment2 = lovelyTwo.ndownPayment;
        var nmonthlyPayment2 = lovelyTwo.nmonthlyPayment;
        var description2 = lovelyTwo.description;
        var imge2 = lovelyTwo.image;
        $('.likeCar .box2 h3').html(name2);
        $('.likeCar .box2 .red').html(ndownPayment2);
        $('.likeCar .box2 .blue').html(nmonthlyPayment2);
        $('.likeCar .box2 .safe').html(description2);
        $('.likeCar .box2 .carImg img').attr('src', jumpUrl + imge2);
        //$('.likeCar .box2 .carImg img').html("<img src='"+ jumpUrl + imge2+"' />" );
        /*单击猜你喜欢二重新请求数据刷新,同时设置选中背景颜色和返回到顶部*/
        $('#con .likeCar .box2').click(function () {
          console.log("lovelyTwo==" + JSON.stringify(lovelyTwo));
          carModelIdVal = lovelyTwo.carModelId;
          productIdVal = lovelyTwo.productId;
          onTouch();
          //selectStute在产品详情页面定义,为”返回"按钮带参数1至跳转的页面，如果是1就返回h5页面，否则返回android页面*/
          location.href = jumpUrl + "page2.html?carModelIdVal=" + carModelIdVal + "&productIdVal=" + productIdVal +
            "&selectStute=" + 1 +
            "&curCityname=" + mUserLocation.city +
            "&longitude=" + mUserLocation.longitude +
            "&latitude=" + mUserLocation.latitude;
        });
      }
    });

  }

  /*触摸猜你喜欢图片开始时背景为灰色,触摸离开背景为白色,同时要加上取消触摸，避免不小心一直选中状态*/
  function onTouch() {
    $('.likeCar .likeInfo').on('touchstart', function () {
      $(this).css("background", "#D8D8D8");
    });
    $('.likeCar .likeInfo').on('touchend', function () {
      $(this).css("background", "#fff");
    });
    $('.likeCar .likeInfo').on('touchcancel', function () {
      $(this).css("background", "#fff");
    });
  }
  ;


  $(document).ready(function () {
    // 判断是否是微信
    if (isWeiXin()) {
      $(".navBar").hide();
      $("#con").css({"padding-top": "0"});
    } else {
      // 判断是否是安卓
      var isAndroid = navigator.userAgent.indexOf('Android') > -1 || navigator.userAgent.indexOf('Adr') > -1;
      if (isAndroid) {
        $(".navBar").css({"padding-top": "0"});
        // $("#con").css({"padding-top": "0.88rem"});
        $(".navBackBtn").css({"top": "0.24rem"});
      }
    }

    // 在app里取消查看全部车型
    if (!isWeiXin() && equipment() == 'IOS') {
      $(".linkBtn").css({"display": "none"});
      $(".carImgs .backBtn").css({"display": "none"});
    }

    // 轮播
    var mySwiper = new Swiper('.swiper-container', {
      direction: 'horizontal', //水平滚动
      loop: true, //自动轮播
      autoplay: 3000, //3s切换一次
      pagination: '.swiper-pagination' // 如果需要分页器

    });

    // 导航栏文字变换
    //                $(".titleName").html($(".carInfo .carName").html());

    // 方案切换
    $(".plans .title p").on("click", function () {
      $(this).addClass("active").siblings().removeClass("active");
      $(".plans .boxWrap .box").eq($(this).index()).removeClass("boxHide").siblings().addClass("boxHide");
    });

    //返回
    $(".backBtn").on("click", function () {
      if (!isWeiXin() && equipment() == 'IOS') {
        backToNative("popToView://backToNative");
      } else {
        window.NativeMethod.callReservationFinishActivity(); //调用Android的方法跳转到首页,首页是原生写
        //history.back();
      }
    });

    // 钱数加逗号
    $(".moneyNum").each(function (index, ele) {
      var str = $(this).html();
      $(this).html(addComma(str))
    });
    lovely();
  });

  function addComma(str) {
    var str1 = str.substring(1);
    return parseFloat(str1).toLocaleString();
  }
</script>
</body>

</html>